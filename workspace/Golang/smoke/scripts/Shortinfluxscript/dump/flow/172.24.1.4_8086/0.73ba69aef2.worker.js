!function(n){var e={};function t(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)t.d(r,o,function(e){return n[e]}.bind(null,o));return r},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=0)}([function(n,e,t){"use strict";t.r(e);var r={},o={};function a(n){return new Function("d","return {"+n.map((function(n,e){return JSON.stringify(n)+": d["+e+'] || ""'})).join(",")+"}")}function u(n){var e=Object.create(null),t=[];return n.forEach((function(n){for(var r in n)r in e||t.push(e[r]=r)})),t}function i(n,e){var t=n+"",r=t.length;return r<e?new Array(e-r+1).join(0)+t:t}function l(n){var e,t=n.getUTCHours(),r=n.getUTCMinutes(),o=n.getUTCSeconds(),a=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":((e=n.getUTCFullYear())<0?"-"+i(-e,6):e>9999?"+"+i(e,6):i(e,4))+"-"+i(n.getUTCMonth()+1,2)+"-"+i(n.getUTCDate(),2)+(a?"T"+i(t,2)+":"+i(r,2)+":"+i(o,2)+"."+i(a,3)+"Z":o?"T"+i(t,2)+":"+i(r,2)+":"+i(o,2)+"Z":r||t?"T"+i(t,2)+":"+i(r,2)+"Z":"")}var c=function(n){var e=new RegExp('["'+n+"\n\r]"),t=n.charCodeAt(0);function i(n,e){var a,u=[],i=n.length,l=0,c=0,s=i<=0,f=!1;function d(){if(s)return o;if(f)return f=!1,r;var e,a,u=l;if(34===n.charCodeAt(u)){for(;l++<i&&34!==n.charCodeAt(l)||34===n.charCodeAt(++l););return(e=l)>=i?s=!0:10===(a=n.charCodeAt(l++))?f=!0:13===a&&(f=!0,10===n.charCodeAt(l)&&++l),n.slice(u+1,e-1).replace(/""/g,'"')}for(;l<i;){if(10===(a=n.charCodeAt(e=l++)))f=!0;else if(13===a)f=!0,10===n.charCodeAt(l)&&++l;else if(a!==t)continue;return n.slice(u,e)}return s=!0,n.slice(u,i)}for(10===n.charCodeAt(i-1)&&--i,13===n.charCodeAt(i-1)&&--i;(a=d())!==o;){for(var p=[];a!==r&&a!==o;)p.push(a),a=d();e&&null==(p=e(p,c++))||u.push(p)}return u}function c(e,t){return e.map((function(e){return t.map((function(n){return f(e[n])})).join(n)}))}function s(e){return e.map(f).join(n)}function f(n){return null==n?"":n instanceof Date?l(n):e.test(n+="")?'"'+n.replace(/"/g,'""')+'"':n}return{parse:function(n,e){var t,r,o=i(n,(function(n,o){if(t)return t(n,o-1);r=n,t=e?function(n,e){var t=a(n);return function(r,o){return e(t(r),o,n)}}(n,e):a(n)}));return o.columns=r||[],o},parseRows:i,format:function(e,t){return null==t&&(t=u(e)),[t.map(f).join(n)].concat(c(e,t)).join("\n")},formatBody:function(n,e){return null==e&&(e=u(n)),c(n,e).join("\n")},formatRows:function(n){return n.map(s).join("\n")},formatRow:s,formatValue:f}}(","),s=c.parse,f=c.parseRows;c.format,c.formatBody,c.formatRows,c.formatRow,c.formatValue;const d=(n,e)=>{if(!n)throw new Error(e)},p=n=>{const e={},t=new Set;let r=0;try{const o=m(n);let a="",u=[],i="",l="",c="",f="";for(const n of o){a=n.split("\n").filter((n=>!n.startsWith("#"))).join("\n").trim(),d(!!a,"could not find annotation lines in Flux response; are `annotations` enabled in the Flux query `dialect` option?"),u=s(a),i=n.split("\n").filter((n=>n.startsWith("#"))).join("\n").trim(),d(!!i,"could not find annotation lines in Flux response; are `annotations` enabled in the Flux query `dialect` option?");const o=y(i,u.columns);for(const n of u.columns.slice(1)){l=g[o.datatypeByColumnName[n]],d(!!l,`encountered unknown Flux column type ${o.datatypeByColumnName[n]}`),c=`${n} (${l})`,e[c]||(e[c]={name:n,type:l,fluxDataType:o.datatypeByColumnName[n],data:[]}),f=o.defaultByColumnName[n];for(let t=0;t<u.length;t++)e[c].data[r+t]=b(u[t][n]||f,l);o.groupKey.includes(n)&&t.add(c)}r+=u.length}h(e,t);const p=Object.entries(e).reduce(((n,[e,{name:t,fluxDataType:o,type:a,data:u}])=>(u.length=r,n.columns[e]={name:t,fluxDataType:o,type:a,data:u},n)),{columns:{}});return{table:p,fluxGroupKeyUnion:Array.from(t)}}catch(n){return{table:{columns:{}},fluxGroupKeyUnion:[],error:n}}},m=n=>{const e=n.trim();if(""===e)return[];return e.split(/\n\s*\n#/).map(((n,e)=>0===e?n:`#${n}`))},y=(n,e)=>{const t=f(n),r=t.find((n=>"#group"===n[0])),o=t.find((n=>"#datatype"===n[0])),a=t.find((n=>"#default"===n[0]));d(!!r,"could not find group annotation in Flux response"),d(!!o,"could not find datatype annotation in Flux response"),d(!!a,"could not find default annotation in Flux response");return{groupKey:r.reduce(((n,t,r)=>"true"===t?[...n,e[r]]:n),[]),datatypeByColumnName:o.slice(1).reduce(((n,t,r)=>Object.assign(Object.assign({},n),{[e[r+1]]:t})),{}),defaultByColumnName:a.slice(1).reduce(((n,t,r)=>Object.assign(Object.assign({},n),{[e[r+1]]:t})),{})}},g={boolean:"boolean",unsignedLong:"number",long:"number",double:"number",string:"string","dateTime:RFC3339":"time"},b=(n,e)=>{if(void 0!==n)return"null"===n?null:"NaN"===n?NaN:"boolean"===e&&"true"===n||("boolean"!==e||"false"!==n)&&("string"===e?n:"time"===e?Date.parse(n.trim()):"number"===e&&""===n?null:"number"===e?Number(n):null)},h=(n,e)=>{const t=Object.values(n).map((n=>n.name)).reduce(((n,e)=>Object.assign(Object.assign({},n),{[e]:(n[e]||0)+1})),{}),r=Object.entries(t).filter((([n,e])=>1===e)).map((([n])=>n));for(const t of r){const[r,o]=Object.entries(n).find((([n,e])=>e.name===t));n[t]=o,delete n[r],e.has(r)&&(e.delete(r),e.add(t))}},j=self;j.addEventListener("message",(n=>{const[e,t]=n.data;j.postMessage([e,p(t)])}))}]);
//# sourceMappingURL=0.73ba69aef2.worker.js.map